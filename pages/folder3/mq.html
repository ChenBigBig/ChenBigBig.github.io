<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>消息队列【RabbitMQ】 | 武林秘籍</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/icon.png">
    <meta name="description" content="ChenBigBig的武林秘籍">
    
    <link rel="preload" href="/assets/css/0.styles.e8e4f3a3.css" as="style"><link rel="preload" href="/assets/js/app.0bd9ad6f.js" as="script"><link rel="preload" href="/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/assets/js/16.26188cf5.js" as="script"><link rel="prefetch" href="/assets/js/10.2b63f33d.js"><link rel="prefetch" href="/assets/js/11.2fe6803a.js"><link rel="prefetch" href="/assets/js/12.6cf5b77a.js"><link rel="prefetch" href="/assets/js/13.e45a7ae8.js"><link rel="prefetch" href="/assets/js/14.9ebc12f7.js"><link rel="prefetch" href="/assets/js/15.a91f92c9.js"><link rel="prefetch" href="/assets/js/17.1c8df4ca.js"><link rel="prefetch" href="/assets/js/18.54015b9e.js"><link rel="prefetch" href="/assets/js/19.57914b98.js"><link rel="prefetch" href="/assets/js/3.98f8877b.js"><link rel="prefetch" href="/assets/js/4.d12742be.js"><link rel="prefetch" href="/assets/js/5.216cae74.js"><link rel="prefetch" href="/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/assets/js/7.9c9172a7.js"><link rel="prefetch" href="/assets/js/8.beb64655.js"><link rel="prefetch" href="/assets/js/9.cf8659dc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8e4f3a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/icon.png" alt="武林秘籍" class="logo"> <span class="site-name can-hide">武林秘籍</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/folder1/base.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder1/collection.html" class="nav-link">
  集合
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder1/thread.html" class="nav-link">
  多线程
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/folder2/spring.html" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/springmvc.html" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/mybatis.html" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/springboot.html" class="nav-link">
  SprintBoot
</a></li></ul></div></div><div class="nav-item"><a href="/pages/folder3/mysql.html" class="nav-link">
  关系型数据库
</a></div><div class="nav-item"><a href="/pages/folder3/nosql.html" class="nav-link">
  非关系型数据库
</a></div><div class="nav-item"><a href="/pages/folder3/mq.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  消息队列
</a></div><div class="nav-item"><a href="/pages/other/other.html" class="nav-link">
  其它
</a></div><div class="nav-item"><a href="https://github.com/ChenBigBig" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/folder1/base.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder1/collection.html" class="nav-link">
  集合
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder1/thread.html" class="nav-link">
  多线程
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/folder2/spring.html" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/springmvc.html" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/mybatis.html" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/springboot.html" class="nav-link">
  SprintBoot
</a></li></ul></div></div><div class="nav-item"><a href="/pages/folder3/mysql.html" class="nav-link">
  关系型数据库
</a></div><div class="nav-item"><a href="/pages/folder3/nosql.html" class="nav-link">
  非关系型数据库
</a></div><div class="nav-item"><a href="/pages/folder3/mq.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  消息队列
</a></div><div class="nav-item"><a href="/pages/other/other.html" class="nav-link">
  其它
</a></div><div class="nav-item"><a href="https://github.com/ChenBigBig" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>消息队列【RabbitMQ】</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder3/mq.html#什么是mq" class="sidebar-link">什么是MQ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/folder3/mq.html#mq的优点" class="sidebar-link">MQ的优点</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/folder3/mq.html#解耦、异步、削峰是什么" class="sidebar-link">解耦、异步、削峰是什么？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/folder3/mq.html#消息队列有什么缺点" class="sidebar-link">消息队列有什么缺点</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/folder3/mq.html#rabbitmq的核心概念" class="sidebar-link">RabbitMQ的核心概念</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/folder3/mq.html#rabbitmq的工作模式" class="sidebar-link">RabbitMQ的工作模式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/folder3/mq.html#如何保证rabbitmq消息的顺序性" class="sidebar-link">如何保证RabbitMQ消息的顺序性？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/folder3/mq.html#如何保证rabbitmq消息的可靠传输" class="sidebar-link">如何保证RabbitMQ消息的可靠传输？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/folder3/mq.html#什么是死信队列" class="sidebar-link">什么是死信队列</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/folder3/mq.html#kafka和rabbitmq的区别" class="sidebar-link">kafka和RabbitMQ的区别</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="消息队列【rabbitmq】"><a href="#消息队列【rabbitmq】" class="header-anchor">#</a> 消息队列【RabbitMQ】</h1> <h2 id="什么是mq"><a href="#什么是mq" class="header-anchor">#</a> 什么是MQ</h2> <p>MQ就是消息队列。是软件和软件进行通信的中间件产品</p> <h2 id="mq的优点"><a href="#mq的优点" class="header-anchor">#</a> MQ的优点</h2> <p>异步处理 - 相比于传统的串行、并行方式，提高了系统吞吐量。<br>
应用解耦 - 系统间通过消息通信，不用关心其他系统的处理。<br>
流量削锋 - 可以通过消息队列长度控制请求量；可以缓解短时间内的高并发请求。<br>
日志处理 - 解决大量日志传输。<br>
消息通讯 - 消息队列一般都内置了高效的通信机制，因此也可以用在纯的消息通讯。比如实现点对点消息队列，或者聊天室等。</p> <h2 id="解耦、异步、削峰是什么"><a href="#解耦、异步、削峰是什么" class="header-anchor">#</a> 解耦、异步、削峰是什么？</h2> <p><strong>解耦</strong>：A 系统发送数据到 BCD 三个系统，通过接口调用发送。如果 E 系统也要这个数据呢？那如果 C 系统现在不需要了呢？A 系统负责人几乎崩溃…A 系统跟其它各种乱七八糟的系统严重耦合，A 系统产生一条比较关键的数据，很多系统都需要 A 系统将这个数据发送过来。如果使用 MQ，A 系统产生一条数据，发送到 MQ 里面去，哪个系统需要数据自己去 MQ 里面消费。如果新系统需要数据，直接从 MQ 里消费即可；如果某个系统不需要这条数据了，就取消对 MQ 消息的消费即可。这样下来，A 系统压根儿不需要去考虑要给谁发送数据，不需要维护这个代码，也不需要考虑人家是否调用成功、失败超时等情况。<br> <strong>异步</strong>：A 系统接收一个请求，需要在自己本地写库，还需要在 BCD 三个系统写库，自己本地写库要 3ms，BCD 三个系统分别写库要 300ms、450ms、200ms。最终请求总延时是 3 + 300 + 450 + 200 = 953ms，接近 1s，用户感觉搞个什么东西，慢死了慢死了。用户通过浏览器发起请求。如果使用 MQ，那么 A 系统连续发送 3 条消息到 MQ 队列中，假如耗时 5ms，A 系统从接受一个请求到返回响应给用户，总时长是 3 + 5 = 8ms。<br> <strong>削峰</strong>：减少高峰时期对服务器压力。</p> <h2 id="消息队列有什么缺点"><a href="#消息队列有什么缺点" class="header-anchor">#</a> 消息队列有什么缺点</h2> <p><strong>系统可用性降低</strong>
本来系统运行好好的，现在你非要加入个消息队列进去，那消息队列挂了，你的系统不是呵呵了。因此，系统可用性会降低；<br> <strong>系统复杂度提高</strong>
加入了消息队列，要多考虑很多方面的问题，比如：一致性问题、如何保证消息不被重复消费、如何保证消息可靠性传输等。因此，需要考虑的东西更多，复杂性增大。<br> <strong>一致性问题</strong>
A 系统处理完了直接返回成功了，人都以为你这个请求就成功了；但是问题是，要是 BCD 三个系统那里，BD 两个系统写库成功了，结果 C 系统写库失败了，咋整？你这数据就不一致了。</p> <h2 id="rabbitmq的核心概念"><a href="#rabbitmq的核心概念" class="header-anchor">#</a> RabbitMQ的核心概念</h2> <p>RabbitMQ 的核心概念主要涵盖以下几个方面：</p> <ol><li>消息（Message）：<br>
消息是 RabbitMQ 中的基本数据单元，用于在应用程序之间传递信息。它由消息头和消息体组成，消息头包含一些元数据，例如路由键等。消息体则包含实际的数据。</li> <li>生产者（Producer）：<br>
生产者是消息的发送者，负责将消息发布到 RabbitMQ 中。它将消息发送到交换机，并指定一个路由键，以描述消息的目标。</li> <li>交换机（Exchange）：<br>
交换机是消息的路由中心，接收来自生产者的消息，并根据特定规则将其路由到一个或多个队列。它根据路由键和绑定规则决定将消息发送到哪些队列。</li> <li>队列（Queue）：<br>
队列是 RabbitMQ 中的消息存储区域，用于暂时保存待处理的消息。生产者将消息发送到交换机，交换机将消息路由到一个或多个队列，消费者则从队列中获取消息进行处理。</li> <li>消费者（Consumer）：<br>
消费者是消息的接收者，负责从队列中获取消息并进行处理。消费者连接到 RabbitMQ，并订阅一个或多个队列以接收发布者发送的消息。一旦有消息可用，消费者将获取并处理该消息。</li> <li>绑定（Binding）：<br>
绑定是交换机和队列之间的关联关系。它定义了交换机如何将消息路由到特定的队列。绑定通常包含一个绑定键（binding key），用于与消息的路由键进行匹配。</li> <li>路由键（Routing Key）：<br>
路由键是用于消息路由的关键字，生产者在发送消息时将消息的路由键与交换机的绑定键进行匹配。交换机根据路由键的匹配结果将消息发送到相应的队列。</li> <li>声明（Declaration）：<br>
在 RabbitMQ 中，声明是指创建交换机、队列和绑定的过程。在使用这些组件之前，需要先声明它们，以确保它们的存在和正确配置。<br>
这些核心概念构成了 RabbitMQ 的基础架构和消息传递流程。了解这些概念可以帮助我们理解 RabbitMQ 的工作原理，并能够设计和实现可靠的消息传递系统。</li></ol> <h2 id="rabbitmq的工作模式"><a href="#rabbitmq的工作模式" class="header-anchor">#</a> RabbitMQ的工作模式</h2> <ol><li>简单模式（Simple Mode）：<br>
在简单模式中，一个生产者将消息发送到一个队列，然后一个消费者从该队列接收和处理消息。这是 RabbitMQ 中最基本的工作模式，适用于单个生产者和单个消费者的场景。</li> <li>工作队列模式（Work Queue Mode）：<br>
工作队列模式中，一个生产者将消息发送到一个队列，多个消费者同时监听该队列，并竞争获取消息进行处理。消息在多个消费者之间被分发，每个消息只被一个消费者处理。这种模式适用于需要在多个消费者之间进行负载均衡的场景。</li> <li>发布/订阅模式（Publish/Subscribe Mode）：<br>
发布/订阅模式中，一个生产者将消息发送到一个交换机，该交换机将消息广播到多个队列。每个队列都有一个消费者监听并接收消息。这种模式适用于需要将消息广播给多个消费者的场景。</li> <li>路由模式（Routing Mode）：<br>
路由模式中，一个生产者将消息发送到一个交换机，并使用特定的路由键来描述消息的目标。交换机根据路由键将消息路由到特定的队列，每个队列都有一个消费者监听并接收消息。这种模式适用于根据路由键将消息分发到不同队列的场景。</li> <li>主题模式（Topic Mode）：<br>
主题模式中，一个生产者将消息发送到一个交换机，并使用主题（通配符）来描述消息的特征。交换机根据主题匹配规则将消息路由到符合条件的队列，每个队列都有一个消费者监听并接收消息。这种模式适用于需要根据消息的特征进行灵活路由的场景。</li></ol> <h2 id="如何保证rabbitmq消息的顺序性"><a href="#如何保证rabbitmq消息的顺序性" class="header-anchor">#</a> 如何保证RabbitMQ消息的顺序性？</h2> <p>1.拆分多个 queue(消息队列)，每个 queue(消息队列) 一个 consumer(消费者)，就是多一些 queue (消息队列)而已，确实是麻烦点；<br>
2.或者就一个 queue (消息队列)但是对应一个 consumer(消费者)，然后这个 consumer(消费者)内部用内存队列做排队，然后分发给底层不同的 worker 来处理。</p> <h2 id="如何保证rabbitmq消息的可靠传输"><a href="#如何保证rabbitmq消息的可靠传输" class="header-anchor">#</a> 如何保证RabbitMQ消息的可靠传输？</h2> <p>生产者到 RabbitMQ：事务机制和 Confirm 机制，注意：事务机制和 Confirm 机制是互斥的，两者不能共存，会导致 RabbitMQ 报错。<br>
RabbitMQ 自身：持久化、集群、普通模式、镜像模式。<br>
RabbitMQ 到消费者：basicAck 机制、死信队列、消息补偿机制</p> <h2 id="什么是死信队列"><a href="#什么是死信队列" class="header-anchor">#</a> 什么是死信队列</h2> <p>死信队列（Dead Letter Queue，简称DLQ）是消息中间件中的一个概念，包括在 RabbitMQ 中。它用于处理无法被消费者成功处理的消息，通常是因为消息过期、消费者无法处理或达到最大重试次数等情况。<br>
当消息被标记为死信时，它将被重新路由到一个特殊的队列，即死信队列。这个队列可以被单独的消费者或者专门的处理逻辑来消费和处理。死信队列允许对无法正常处理的消息进行后续处理，以便进行错误处理、重试或记录日志等操作。<br> <strong>死信队列的使用场景包括</strong>：
  1. 消息过期：当消息在一定时间内未被消费者处理，可以被标记为死信并转发到死信队列，避免消息一直阻塞在队列中。
  2. 消费失败：当消费者在处理消息时发生错误或无法处理时，可以将消息标记为死信，并将其发送到死信队列，以便进一步进行错误处理或重试。
  3. 消息重试：当消息消费失败时，可以将消息发送到死信队列，并在死信队列中进行一系列的重试策略，以尝试重新处理这些失败的消息。
通过使用死信队列，我们可以更好地处理无法被消费者成功处理的消息，实现错误恢复和消息重试的机制。这提高了消息系统的可靠性和容错性，并确保重要的消息不会被丢失或永远阻塞在队列中。</p> <h2 id="kafka和rabbitmq的区别"><a href="#kafka和rabbitmq的区别" class="header-anchor">#</a> kafka和RabbitMQ的区别</h2> <p>RabbitMQ和Kafka是两个不同的消息中间件，它们在设计和使用上有一些区别。以下是RabbitMQ和Kafka之间的一些主要区别：</p> <ol><li>数据处理模型：
<ul><li>RabbitMQ：RabbitMQ是基于传统的消息队列模型，使用队列来存储消息，并按照先进先出（FIFO）的顺序进行消息传递。它支持多种消息模式，如点对点（Point-to-Point）和发布/订阅（Publish/Subscribe）模式。</li> <li>Kafka：Kafka是一种分布式的流处理平台，它采用了发布/订阅模型。数据以topic（主题）的形式进行发布，并且可以被多个消费者组（Consumer Group）并行地消费。Kafka以日志的形式存储消息，可以保留一定时间的历史数据。</li></ul></li> <li>数据存储和持久化：
<ul><li>RabbitMQ：RabbitMQ使用队列进行消息存储，可以将消息持久化到磁盘上，以确保消息在服务重启后不会丢失。它适合于实时性要求较高、消息量较小的场景。</li> <li>Kafka：Kafka使用日志存储消息，保留了一段时间内的历史消息。它的存储机制基于文件系统，可以处理高吞吐量的数据流。Kafka适用于需要持久化大量数据和支持数据回放的场景。</li></ul></li> <li>数据处理能力和延迟：
<ul><li>RabbitMQ：RabbitMQ适用于低延迟的消息传递，具有快速的消息投递和消费响应时间。它适合于需要即时性和可靠性的应用场景。</li> <li>Kafka：Kafka在处理大规模数据流时表现出色，具有高吞吐量和低延迟的特点。它适用于需要处理大量数据和实时数据流的场景。</li></ul></li> <li>生态系统和使用场景：
<ul><li>RabbitMQ：RabbitMQ是一个成熟的消息中间件，有广泛的使用和支持。它适用于各种传统的应用场景，如任务队列、发布/订阅、异步通信等。</li> <li>Kafka：Kafka是为大数据流和流处理场景设计的，具有强大的数据处理能力。它适用于日志收集、实时数据处理、事件驱动架构等场景。</li></ul></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0bd9ad6f.js" defer></script><script src="/assets/js/2.733019b2.js" defer></script><script src="/assets/js/16.26188cf5.js" defer></script>
  </body>
</html>
